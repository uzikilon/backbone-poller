/*
(c) 2012 Uzi Kilon, Splunk Inc.
Backbone Poller 0.2.7
https://github.com/uzikilon/backbone-poller
Backbone Poller may be freely distributed under the MIT license.
*/
!function(t,i){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],i):t.Backbone.Poller=i(t._,t.Backbone)}(this,function(t,i){"use strict";function e(i){return t.find(u,function(t){return t.model===i})}function n(t,i){this.model=t,this.set(i)}function o(i){if(r(i)){var e=t.extend({},i.options,{success:function(t,e){i.trigger("success",t,e),s(i)},error:function(t,e){i.stop({silent:!0}),i.trigger("error",t,e)}});i.trigger("fetch",i.model),i.xhr=i.model.fetch(e)}}function s(i){r(i)&&(i.timeoutId=t.delay(o,i.options.delay,i))}function r(t){return t.options.active?t.options.condition(t.model)!==!0?(t.stop({silent:!0}),t.trigger("complete",t.model),!1):!0:!1}var c={delay:1e3,condition:function(){return!0}},h=["start","stop","fetch","success","error","complete"],u=[],f={get:function(t,i){var o=e(t);return o?o.set(i):(o=new n(t,i),u.push(o)),i&&i.autostart===!0&&o.start({silent:!0}),o},size:function(){return u.length},reset:function(){for(;u.length;)u.pop().stop()}};return t.extend(n.prototype,i.Events,{set:function(e){return this.options=t.extend({},c,e||{}),this.options.flush&&this.off(),t.each(h,function(i){var e=this.options[i];t.isFunction(e)&&(this.off(i,e,this),this.on(i,e,this))},this),this.model instanceof i.Model&&this.model.on("destroy",this.stop,this),this.stop({silent:!0})},start:function(t){return this.active()||(t&&t.silent||this.trigger("start",this.model),this.options.active=!0,this.options.delayed?s(this):o(this)),this},stop:function(t){return t&&t.silent||this.trigger("stop",this.model),this.options.active=!1,this.xhr&&this.xhr.abort&&this.xhr.abort(),this.xhr=null,clearTimeout(this.timeoutId),this.timeoutId=null,this},active:function(){return this.options.active===!0}}),f});